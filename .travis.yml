os: osx
osx_image: xcode10.2
language: objective-c
sudo: false
env:
  global:
  - THEOS=~/theos
before_install:
  - brew update
  - brew install dpkg ldid
  - git clone --recursive git://github.com/theos/theos.git ~/theos
script:
  - "export VERSION=$(grep 'Version: ' control | sed 's/^.*: //')"
  - "export DESCRIPTION=$(awk '/## v$VERSION/{getline; print}' README.md)"
  - "export FILENAME='packages/'\"$(grep 'Package: ' control | sed 's/^.*: //')\"'_'\"$VERSION\"'_iphoneos-arm.deb'"
  - make package
before_deploy:
  - git config --local user.name "Jeff Rescignano"
  - git config --local user.email "jeff@jeffresc.com"
  - git tag -a v$VERSION -m "$DESCRIPTION"
deploy:
  provider: releases
  api_key:
    secure: DpvH8pB5QkVK9SNvMF6h2pztdbG7pQ5l0pLDpFKvKSxqqIO5XdrmvPREjOoi6u5ZlPZw7BKNBsOZOF9W++dD2c+eII4ZKQ/N9xRf/XLV4BWVatyKycldsTvd6r2oW6bFp2o7dXeYkPbX54xmQv5kM7wW2iqT/OQPyEVpy27YSdMCmBEMgHtLcy04QxMP3jfGpSF3a9LFc81h0pQQd1O1FB80scXMuYKnIei8Vxrxt1Abt4Sz56+mkPrxquVxhsYfMKXgj1Y/H7xYGU6vMmCtHEcJfwZCJYhtt0XZQIGCh6eIps0UECCCnn3A1hRFMEwJZIqAo5yWvl7QPtPDii8xtWd15StSwvZg6zIRhc131Gs40BDU64u2u+nn6hSKO2ZMi4QBmKCVUakSPaJFCLWZE6RDKS6omkMxE6zTYuIyuxl1zilp7rm27QKMpEO2iG7cPdV77f3X7kG76cbCj7e0GEYzgwpTRrT3jf2fkKdavBBUVdau8eCxxwDbk1Y0YdQJ4xlT5HcWDvuGSmB6M2XL2a9enU917QZE52B8kEzvRI36/3fWYwoSfB8obvRY1s0jJ/DQkETb8Jhbg7H+VaGFZh6fLXOYM5L99o1lM5W1hjqNz4IKdDtMea+gDmeVDMjzmSiJ73y5tEEi0hWjWkbmefEeUtpkh1B/P2IJso7+JuM=
  file: $FILENAME
  skip_cleanup: true
  on:
    branches:
      only:
        - release
